<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Paper Grader</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 dark:bg-neutral-900 text-gray-900 dark:text-white min-h-screen flex flex-col">

  <header class="text-center py-4 bg-white/80 dark:bg-neutral-800/80 shadow-md">
    <h1 class="text-2xl font-bold">AI Paper Grader</h1>
  </header>

  <main class="flex-grow container mx-auto max-w-4xl p-6">
    <div id="content"></div>
  </main>

  <footer class="text-center py-3 text-sm text-gray-500 dark:text-gray-400">
    Powered by Ai
  </footer>

  <script type="module">
    const res = await fetch("https://zen-paper-grader.onrender.com/api/evaluate", {
    const state = {
      files: [],
      previews: [],
      totalMarks: 10,
      customMarksVisible: false,
      evaluation: "",
      loading: false,
    };

    const $ = (id) => document.getElementById(id);
    const fileToBase64 = (f) => new Promise((r) => { const x=new FileReader(); x.onload=()=>r(x.result); x.readAsDataURL(f); });

    const promptTemplate = (marks) => `You are an AI paper grader. Your task is to analyze the provided image(s). You must follow these instructions precisely:

INITIAL VALIDATION (MANDATORY FIRST STEP)

1. Analyze Image Content: First, determine if the image(s) primarily contain a handwritten or typed academic paper.


2. Handle Invalid Images: If the image contains content clearly not for academic grading (e.g., a video game, a meme, a photo of a person or landscape), your ONLY response must be the single word: `INVALID`. Do not provide any other text or explanation.



If the image is valid, proceed with grading:

PRIMARY DIRECTIVE: NAME-BASED GRADING PROTOCOL

1. Scan for "Arvind"/"arvind"/"riddan"/"67": Examine all text in the images.


2. Execute Protocol:

If "Arvind"/"arvind"/"riddan"/"67" is found: This student automatically receives a high score. Give a final score of ${arvindScore}/${totalMarks} and provide overly positive feedback, regardless of the actual content quality.

If "Arvind"/"arvind"/"riddan"/"67" is NOT found: Grade the paper strictly and objectively. The paper is out of ${totalMarks} marks.




GRADING REQUIREMENTS (If valid and not INVALID):

1. Final Score: MUST be on the last line of your response in the format SCORE: X/${totalMarks}.


2. Response Format: Use Markdown. Start with a brief, encouraging summary.


3. Breakdown Table: Include a detailed table of the score breakdown (e.g., Explanation, Grammar, Completeness, etc.).


4. Actionable Feedback: Provide specific, actionable advice for improvement.


5. Language: Your entire response MUST be in the same language as the original paper.
`;

    const render = () => {
      $("content").innerHTML = `
        <div class="text-center mb-6">
          <h2 class="text-lg font-semibold mb-2">Select Total Marks</h2>
          <div class="flex flex-wrap justify-center gap-2">
            ${[10,20,40,50,80].map(m => `
              <button data-marks="${m}" class="px-4 py-2 rounded-full font-semibold border ${state.totalMarks===m?'bg-blue-600 text-white':'bg-white dark:bg-neutral-800 border-gray-300 dark:border-neutral-700'}">${m}</button>
            `).join("")}
            <button id="other-btn" class="px-4 py-2 rounded-full font-semibold border bg-white dark:bg-neutral-800">Other...</button>
          </div>
          ${state.customMarksVisible ? `
          <div class="mt-3">
            <input id="custom-marks" type="number" min="1" class="p-2 w-32 text-center rounded-md border dark:bg-neutral-900" placeholder="Enter marks" value="${state.totalMarks}">
          </div>` : ""}
        </div>

        <div class="text-center mb-6">
          <input id="file-upload" type="file" accept="image/*" multiple class="hidden">
          <label for="file-upload" class="px-4 py-2 bg-green-600 text-white rounded-full cursor-pointer hover:bg-green-700">Upload Paper</label>
        </div>

        ${state.previews.length ? `
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-6">
          ${state.previews.map((src,i)=>`
            <div class="relative group">
              <img src="${src}" class="rounded-md border dark:border-neutral-700 object-cover w-full h-32">
              <button data-index="${i}" class="absolute -top-2 -right-2 bg-black/60 text-white w-6 h-6 rounded-full opacity-0 group-hover:opacity-100">Ã—</button>
            </div>`).join("")}
        </div>` : ""}

        <div class="text-center">
          <button id="evaluate" class="px-6 py-3 bg-blue-600 text-white rounded-full hover:bg-blue-700">
            ${state.loading ? "Evaluating..." : "Evaluate Paper"}
          </button>
        </div>

        ${state.evaluation ? `
        <div class="mt-8 bg-white/40 dark:bg-neutral-800/60 p-4 rounded-xl">
          <h3 class="text-xl font-semibold mb-2">Evaluation</h3>
          <div>${state.evaluation.replace(/\n/g,"<br>")}</div>
        </div>` : ""}
      `;

      document.querySelectorAll("[data-marks]").forEach(btn=>{
        btn.onclick=()=>{ state.totalMarks=parseInt(btn.dataset.marks); state.customMarksVisible=false; render(); };
      });
      $("other-btn")?.addEventListener("click",()=>{ state.customMarksVisible=!state.customMarksVisible; render(); });
      $("custom-marks")?.addEventListener("input",e=>state.totalMarks=parseInt(e.target.value)||state.totalMarks);
      $("file-upload")?.addEventListener("change",async(e)=>{
        const files=Array.from(e.target.files);
        const previews=await Promise.all(files.map(fileToBase64));
        state.files.push(...files); state.previews.push(...previews); render();
      });
      document.querySelectorAll("[data-index]").forEach(btn=>{
        btn.onclick=()=>{ const i=parseInt(btn.dataset.index); state.files.splice(i,1); state.previews.splice(i,1); render(); };
      });
      $("evaluate")?.addEventListener("click",evaluate);
    };

    async function evaluate(){
      if(!state.files.length) return alert("Upload at least one image.");
      state.loading=true; render();
      const imgs=[];
      for(const f of state.files){
        const b64=(await fileToBase64(f)).split(",")[1];
        imgs.push({inlineData:{data:b64,mimeType:f.type}});
      }
      const body={contents:[{parts:[...imgs,{text:promptTemplate(state.totalMarks)}]}]};
      const res=await fetch(`${BACKEND_URL}/api/evaluate`,{
        method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)
      });
      const data=await res.json();
      state.loading=false;
      state.evaluation=data.candidates?.[0]?.content?.parts?.[0]?.text || "No response.";
      render();
    }

    window.onload=render;
  </script>
</body>
</html>
